(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;d=/\D+|\d+(\.\d+)?[ETGMkmμnpf]?/g,k=function(a,b){var c,e,g,h,i,j,k,l;for(i=(a+"").match(d),j=(b+"").match(d),e=k=0,l=Math.min(i.length,j.length);l>=0?l>k:k>l;e=l>=0?++k:--k)if(isNaN(parseInt(i[e]))||isNaN(parseInt(j[e]))){if(g=i[e].toUpperCase(),h=j[e].toUpperCase(),h>g)return-1;if(g>h)return 1}else if(c=f(i[e])-f(j[e]),0!==c)return c;return i.length-j.length},g=function(a,b){return-k(a,b)},n=function(a,b,c){return function(d){var e,f,g;for(e=f=0,g=a.length;g>=0?g>f:f>g;e=g>=0?++f:--f)if(!(d<a[e]))return(d/a[e]).toPrecision(c[Math.min(c.length-1,e)])+b[e];return d.toPrecision(c[c.length-1])}},m=function(a,b){return function(c){var d,e,f;for(c+="",d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)if(!(c.indexOf(b[d],c.length-b[d].length)<0))return+c.slice(0,c.length-b[d].length)*a[d];return parseFloat(c)}},j=n([1e15,1e12,1e9,1e6,1e3,1,.001,1e-6,1e-9,1e-12,1e-15],["E","T","G","M","k","","m","μ","n","p","f",""],[3]),f=m([1e15,1e12,1e9,1e6,1e3,.001,1e-6,1e-9,1e-12,1e-15,1],["E","T","G","M","k","m","μ","n","p","f",""]),l=n([31556952,604800,86400,3600,60,1,.001,1e-6,1e-9,1e-12],["y","w","d","h","m","s","ms","μs","ns","ps",""],[2,2,2,2,2,2,3]),i=function(a){return(100*a).toPrecision(3)+"%"},a=function(a,b,c){var d,e,f,g,h,i,j,k;for(null==c&&(c=function(a){return a}),i=[0,a.length],h=i[0],d=i[1],e=Math.floor((h+d)/2),j=[c(a[e]),c(a[e+1])],f=j[0],g=j[1];!(b>f)||b>g;){if(b>g&&(h=e+1),b>f||(d=e),h>=d)return d;e=Math.floor((h+d)/2),k=[c(a[e]),c(a[e+1])],f=k[0],g=k[1]}return e+1},b=[],h=function(a,b){var c,d;return d=b.times[0],c=b.times[b.times.length-1],a.rangeSlider({bounds:{min:d,max:c},defaultValues:{min:d,max:c/2},range:{min:.2},formatter:function(a){return Math.round(1e3*a)+"ms"},valueLabels:"change"})},e=function(c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(u=e.min,n=e.max-e.min,w=a(d.times,u),o=a(d.times,e.max),j=c.width(),h=c.height(),g=h/16,f=.8*g,i=2/j,l=[],k=0,s=[],b=[],m=c.clearCanvas(),x=function(a){var c,d,e,k,l,o,p;return o=j*a.left,p=h-(a.top+1)*g,l=j*(a.right-a.left),d=f,c=chroma.hsl(222-222*Math.atan((a.multiplicity||0)/20)*2/Math.PI,.55,.55),m.drawRect({x:o,y:p,width:l,height:d,fillStyle:c.hex(),strokeWidth:1,strokeStyle:c.darken().hex(),fromCenter:!1}),b.push({left:o,right:o+l,top:p,bottom:p+d,label:(a.multiplicity?""+a.multiplicity+" labels<br>("+a.label+", etc)":a.label)+("<br>spanning "+Math.round((a.right-a.left)*n*1e3)+"ms")}),!a.multiplicity&&l>4*i&&(k={fillStyle:"#fff",strokeWidth:0,fontSize:"1em",text:a.label,fromCenter:!1},e=m.measureText(k),e.width+2*i<=l)?(k.x=o+(l-e.width)/2,k.y=p+(d-e.height)/2,m.drawText(k)):void 0},q=y=0;w>y;q=y+=1)if(r=d.labels[q],r.length){for(;k>=l.length;)l.push(null);l[k]={label:r,left:0,right:0,top:k},k++}else k--;for(q=z=w;o>z;q=z+=1)if(r=d.labels[q],v=(d.times[q]-u)/n,r.length){for(;k>=l.length;)l.push(null);l[k]={label:r,left:v,right:0,top:k},k++}else if(k--,p=l[k],p.right=v,v-p.left<i){for(;k>=s.length;)s.push(null);if(t=s[k],p.left-(null!=t?t.right:void 0)<i){t.right=v,t.multiplicity=(t.multiplicity||0)+1;continue}t&&t.right-t.left>=i&&x(t),s[k]=p}else x(p);for(A=0,B=s.length;B>A;A++)t=s[A],t&&t.right-t.left>=i&&x(t);for(;k-->0;)p=l[k],p.right=1,x(p);return b.sort(function(a,b){return a.right-b.right})},c=function(c){var d,f,g,i,j;return g=$(".traceview>.plot"),i=$(".traceview>.slider"),g.attr("width",i.width()),h(i,c),e(g,c,i.rangeSlider("values")),i.on("valuesChanging",function(a,b){return e(g,c,b.values)}),j=$(".tooltip"),d=function(c){var d,e,f,h,i,k,l,m,n;for(f=g.offset(),m=[c.pageX-f.left,c.pageY-f.top],i=m[0],k=m[1],h=a(b,i,function(a){return null!=a?a.right:void 0}),e=l=h,n=b.length;n>l;e=l+=1)if(d=b[e],!(i<=d.left||k<=d.top||k>d.bottom))return j.children(".tooltip-inner").html(d.label),void j.addClass("in").offset({left:f.left+(d.right+d.left-j.width())/2,top:f.top+d.top-j.height()-20});return j.removeClass("in")},f=function(a){return j.removeClass("in")},g.mousemove(d),j.mousemove(d),g.mouseout(f)},$(function(){return $.getJSON("trace.json").done(function(a){return c(a)})})}).call(this);