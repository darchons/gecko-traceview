(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;g=/\D+|\d+(\.\d+)?[ETGMkmμnpf]?/g,n=function(a,b){var c,d,e,f,h,j,k,l;for(h=(a+"").match(g),j=(b+"").match(g),d=k=0,l=Math.min(h.length,j.length);l>=0?l>k:k>l;d=l>=0?++k:--k)if(isNaN(parseInt(h[d]))||isNaN(parseInt(j[d]))){if(e=h[d].toUpperCase(),f=j[d].toUpperCase(),f>e)return-1;if(e>f)return 1}else if(c=i(h[d])-i(j[d]),0!==c)return c;return h.length-j.length},j=function(a,b){return-n(a,b)},q=function(a,b,c){return function(d){var e,f,g;for(e=f=0,g=a.length;g>=0?g>f:f>g;e=g>=0?++f:--f)if(!(d<a[e]))return(d/a[e]).toPrecision(c[Math.min(c.length-1,e)])+b[e];return d.toPrecision(c[c.length-1])}},p=function(a,b){return function(c){var d,e,f;for(c+="",d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)if(!(c.indexOf(b[d],c.length-b[d].length)<0))return+c.slice(0,c.length-b[d].length)*a[d];return parseFloat(c)}},m=q([1e15,1e12,1e9,1e6,1e3,1,.001,1e-6,1e-9,1e-12,1e-15],["E","T","G","M","k","","m","μ","n","p","f",""],[3]),i=p([1e15,1e12,1e9,1e6,1e3,.001,1e-6,1e-9,1e-12,1e-15,1],["E","T","G","M","k","m","μ","n","p","f",""]),o=q([31556952,604800,86400,3600,60,1,.001,1e-6,1e-9,1e-12],["y","w","d","h","m","s","ms","μs","ns","ps",""],[2,2,2,2,2,2,3]),l=function(a){return(100*a).toPrecision(3)+"%"},a=function(a,b,c){var d,e,f,g,h,i,j,k;for(null==c&&(c=function(a){return a}),i=[0,a.length],h=i[0],d=i[1],e=Math.floor((h+d)/2),j=[c(a[e]),c(a[e+1])],f=j[0],g=j[1];!(b>f)||b>g;){if(b>g&&(h=e+1),b>f||(d=e),h>=d)return d;e=Math.floor((h+d)/2),k=[c(a[e]),c(a[e+1])],f=k[0],g=k[1]}return e+1},c=function(a){return a&&a.replace(/</g,"&lt;").replace(/>/g,"&gt;")},b=[],d=function(a,b){var c,d,e,f;return d=a.strings[b],e=d.lastIndexOf("("),f=d.lastIndexOf("/"),c=d.lastIndexOf(":"),e>=0&&f>e&&c>f?d.slice(0,e+1)+d.slice(f+1):0>e&&f>=0&&c>f?d.slice(f+1):d},k=function(a,b){var c,d,e;return e=a.slider,d=b.times[0],c=b.times[b.times.length-1],e.rangeSlider({bounds:{min:d,max:c},defaultValues:{min:d,max:2*(c-d)/3+d},range:{min:15*(c-d)/e.width()},formatter:function(a){return Math.round(a)+"ms"},valueLabels:"change"})},f=function(b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(q=b.table,n=a(e.times,f.min),g=a(e.times,f.max),m=[],j=[],p={},h=s=n;g>=n?g>s:s>g;h=g>=n?++s:--s)x=[r,e.times[h]],l=x[0],r=x[1],i=d(c,e.labels[h]),k=i.length?m[m.length-1]:m.pop(),i.length&&m.push(i),null!=k&&(null!=p[k]?(i.length||p[k].count++,p[k].time+=r-l):(j.push(k),p[k]={count:i.length?0:1,time:r-l}));for(t=0,v=m.length;v>t;t++)i=m[t],p[i].count++;for(j.sort(function(a,b){return p[b].time-p[a].time}),q.empty(),h=u=0,w=j.length;w>u;h=++u)i=j[h],o=p[i],q.append($("<tr/>").append($("<td/>").text(i),$("<td/>").text(o.count),$("<td/>").text((o.time/o.count).toFixed(3)),$("<td/>").text(o.time.toFixed(3))));return $.bootstrapSortable()},h=function(c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;for(y=c.plot,x=g.min,q=g.max-g.min,A=a(f.times,x),r=a(f.times,g.max),m=y.width(),k=y.height(),j=k/25,i=.8*j,l=4/m,h=parseFloat(y.css("fontSize")),p=y[0].getContext("2d"),p.font="1em sans-serif",p.textAlign="left",p.textBaseline="top",p.fillStyle="#fff",p.fillRect(0,0,m,k),o=[],n=0,v=[],b=[],B=function(a){var c,d,e,f,g,n,o;return n=m*a.left,o=k-(a.top+1)*j,g=m*(a.right-a.left),d=i,c=chroma.hsl(222-222*Math.atan((a.multiplicity||0)/20)*2/Math.PI,.55,.55),e=a.label,p.fillStyle=c.hex(),p.fillRect(n,o,g,d),p.strokeStyle=c.darken().hex(),p.strokeRect(n,o,g,d),!a.multiplicity&&g>4*l&&(f=p.measureText(e),f.width+2*l<=g&&(p.fillStyle="#fff",p.fillText(e,n+(g-f.width)/2,o+(d-h)/2))),b.push({left:n,right:n+g,top:o,bottom:o+d,label:e,labels:a.labels,multiplicity:a.multiplicity,duration:Math.round((a.right-a.left)*q)})},t=C=0;A>C;t=C+=1)if(u=d(e,f.labels[t]),u.length){for(;n>=o.length;)o.push(null);o[n]={label:u,left:0,right:0,top:n},n++}else n--;for(t=D=A;r>D;t=D+=1)if(u=d(e,f.labels[t]),z=(f.times[t]-x)/q,u.length){for(;n>=o.length;)o.push(null);o[n]={label:u,left:z,right:0,top:n},n++}else if(n--,s=o[n],s.right=z,z-s.left<l){for(;n>=v.length;)v.push(null);if(w=v[n],s.left-(null!=w?w.right:void 0)<l){w.right=z,w.multiplicity=(w.multiplicity||1)+1,w.labels[s.label]=(w.labels[s.label]||0)+1;continue}w&&w.right-w.left>=l&&B(w),s.labels={},s.labels[s.label]=1,v[n]=s}else B(s);for(E=0,F=v.length;F>E;E++)w=v[E],w&&w.right-w.left>=l&&B(w);for(;n-->0;)s=o[n],s.right=1,B(s);return b.sort(function(a,b){return a.right-b.right})},e=function(d,e){var g,i,j,l,m,n;return i={container:$(".traceview .plot-container"),plot:$(".traceview .plot"),tooltip:$(".traceview .tooltip"),marker:$(".traceview .marker"),timestamp:$(".traceview .marker .timestamp"),slider:$(".traceview .slider"),table:$(".stats tbody")},i.plot.attr("width",i.slider.width()),i.marker.height(i.plot.height()),g=null,k(i,e),h(i,d,e,i.slider.rangeSlider("values")),i.slider.on("valuesChanging",function(a,b){return window.requestAnimationFrame(function(){return g=null,i.marker.hide(),h(i,d,e,b.values)})}),f(i,d,e,i.slider.rangeSlider("values")),i.slider.on("valuesChanged",function(a,b){return f(i,d,e,b.values)}),l=function(d){var e,f,h,j,k,l,m,n,o,p,q,r,s,t,u,v;if(e=10,o=i.plot.offset(),u=[d.pageX-o.left,d.pageY-o.top],r=u[0],s=u[1],q=a(b,r,function(a){return null!=a?a.right:void 0}),p=i.slider.rangeSlider("values"),g&&!g.stopped)return f=Math.abs(d.pageX-g.x),i.timestamp.text("<"+Math.round(f/i.plot.width()*(p.max-p.min))+"ms>"),i.marker.width(Math.max(1,f)),void i.marker.offset({left:Math.min(d.pageX,g.x),top:o.top});if(g&&g.stopped){if(i.marker.addClass("zoomin"),n=i.marker.offset(),d.pageX>n.left&&d.pageX<n.left+i.marker.width())return void i.tooltip.hide()}else i.timestamp.text(""+Math.round(r/i.plot.width()*(p.max-p.min)+p.min)+"ms"),i.marker.removeClass("zoomin").width(1).show().offset({left:d.pageX,top:o.top});for(j=t=q,v=b.length;v>t;j=t+=1)if(h=b[j],!(r<=h.left||s<=h.top||s>h.bottom))return h.labels?(l=""+h.multiplicity+" labels:<br><br>",m=Object.keys(h.labels),m.sort(function(a,b){return h.labels[b]-h.labels[a]}),l+=function(){var a,b,d,e;for(d=m.slice(0,3),e=[],a=0,b=d.length;b>a;a++)k=d[a],e.push(""+h.labels[k]+" &times; "+(""+c(k)+"<br>"));return e}().join("")):l=c(h.label),l+="<br>spanning "+h.duration+"ms",i.tooltip.children(".tooltip-inner").html(l),void i.tooltip.show().offset({left:Math.max(e,Math.min(i.plot.width()-i.tooltip.width(),o.left+(h.right+h.left-i.tooltip.width())/2)),top:o.top+h.top-i.tooltip.height()-e});return i.tooltip.hide()},m=function(a){return i.tooltip.hide(),g?void(g.stopped=!0):i.marker.hide()},j=function(a){var b,c,d,e,f,h,j;if(!i.tooltip.is(":visible"))return b=i.marker.offset(),c=i.marker.width(),(null!=g?g.stopped:void 0)&&a.pageX>b.left&&a.pageX<b.left+c?(f=i.plot.offset(),h=i.plot.width(),j=i.slider.rangeSlider("values"),g=null,e=function(a){return(a-f.left)/h*(j.max-j.min)+j.min},d={min:e(b.left),max:e(b.left+c)},i.slider.rangeSlider("values",d.min,d.max),i.slider.trigger("valuesChanging",{values:d}),i.slider.trigger("valuesChanged",{values:d}),void l(a)):(g={x:a.pageX,y:a.pageY},l(a),a.preventDefault())},n=function(a){return g?Math.abs(a.pageX-g.x)<2&&Math.abs(a.pageY-g.y)<2?(g=null,void l(a)):g.stopped=!0:void 0},i.container.mousemove(l),i.container.mouseleave(m),i.container.mousedown(j),i.container.mouseup(n)},$(function(){var a;return a=$("#tracefile"),a.change(function(){return $.getJSON(a.val()).done(function(a){return e(a,a.trace[0])})}),a.trigger("change")})}).call(this);