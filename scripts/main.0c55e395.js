(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;g=/\D+|\d+(\.\d+)?[ETGMkmμnpf]?/g,m=function(a,b){var c,d,e,f,h,j,k,l;for(h=(a+"").match(g),j=(b+"").match(g),d=k=0,l=Math.min(h.length,j.length);l>=0?l>k:k>l;d=l>=0?++k:--k)if(isNaN(parseInt(h[d]))||isNaN(parseInt(j[d]))){if(e=h[d].toUpperCase(),f=j[d].toUpperCase(),f>e)return-1;if(e>f)return 1}else if(c=i(h[d])-i(j[d]),0!==c)return c;return h.length-j.length},j=function(a,b){return-m(a,b)},p=function(a,b,c){return function(d){var e,f,g;for(e=f=0,g=a.length;g>=0?g>f:f>g;e=g>=0?++f:--f)if(!(d<a[e]))return(d/a[e]).toPrecision(c[Math.min(c.length-1,e)])+b[e];return d.toPrecision(c[c.length-1])}},o=function(a,b){return function(c){var d,e,f;for(c+="",d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)if(!(c.indexOf(b[d],c.length-b[d].length)<0))return+c.slice(0,c.length-b[d].length)*a[d];return parseFloat(c)}},l=p([1e15,1e12,1e9,1e6,1e3,1,.001,1e-6,1e-9,1e-12,1e-15],["E","T","G","M","k","","m","μ","n","p","f",""],[3]),i=o([1e15,1e12,1e9,1e6,1e3,.001,1e-6,1e-9,1e-12,1e-15,1],["E","T","G","M","k","m","μ","n","p","f",""]),n=p([31556952,604800,86400,3600,60,1,.001,1e-6,1e-9,1e-12],["y","w","d","h","m","s","ms","μs","ns","ps",""],[2,2,2,2,2,2,3]),k=function(a){return(100*a).toPrecision(3)+"%"},a=function(a,b,c){var d,e,f,g,h,i,j,k;for(null==c&&(c=function(a){return a}),i=[0,a.length],h=i[0],d=i[1],e=Math.floor((h+d)/2),j=[c(a[e]),c(a[e+1])],f=j[0],g=j[1];!(b>f)||b>g;){if(b>g&&(h=e+1),b>f||(d=e),h>=d)return d;e=Math.floor((h+d)/2),k=[c(a[e]),c(a[e+1])],f=k[0],g=k[1]}return e+1},c=function(a){return a&&a.replace(/</g,"&lt;").replace(/>/g,"&gt;")},b=[],d=function(a,b){var c,d,e,f;return d=a.strings[b],e=d.lastIndexOf("("),f=d.lastIndexOf("/"),c=d.lastIndexOf(":"),e>=0&&f>e&&c>f?d.slice(0,e+1)+d.slice(f+1):0>e&&f>=0&&c>f?d.slice(f+1):d},f=function(a,b,c){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(l=a.slider,p=a.table,i=c.times[0],h=c.times[c.times.length-1],l.rangeSlider({bounds:{min:i,max:h},defaultValues:{min:i,max:h},range:{min:15*(h-i)/l.width()},formatter:function(a){return Math.round(a)+"ms"},valueLabels:"change"}),m=[],g=[],o={},e=r=0,w=c.labels.length;w>=0?w>r:r>w;e=w>=0?++r:--r)x=[q,c.times[e]],k=x[0],q=x[1],f=d(b,c.labels[e]),j=f.length?m[m.length-1]:m.pop(),f.length&&m.push(f),null!=j&&(null!=o[j]?(f.length||o[j].count++,o[j].time+=q-k):(g.push(j),o[j]={count:f.length?0:1,time:q-k}));for(s=0,u=m.length;u>s;s++)f=m[s],o[f].count++;for(e=t=0,v=g.length;v>t;e=++t)f=g[e],n=o[f],p.append($("<tr/>").append($("<td/>").text(f),$("<td/>").text(n.count),$("<td/>").text((n.time/n.count).toFixed(3)),$("<td/>").text(n.time.toFixed(3))));return $.bootstrapSortable()},h=function(c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(x=c.plot,w=g.min,p=g.max-g.min,z=a(f.times,w),q=a(f.times,g.max),l=x.width(),j=x.height(),i=j/25,h=.8*i,k=4/l,o=x.clearCanvas(),n=[],m=0,u=[],b=[],A=function(a){var c,d,e,f,g,m,n,q;return n=l*a.left,q=j-(a.top+1)*i,m=l*(a.right-a.left),d=h,c=chroma.hsl(222-222*Math.atan((a.multiplicity||0)/20)*2/Math.PI,.55,.55),e=a.label,o.drawRect({x:n,y:q,width:m,height:d,fillStyle:c.hex(),strokeWidth:1,strokeStyle:c.darken().hex(),fromCenter:!1}),b.push({left:n,right:n+m,top:q,bottom:q+d,label:e,labels:a.labels,multiplicity:a.multiplicity,duration:Math.round((a.right-a.left)*p)}),!a.multiplicity&&m>4*k&&(g={x:n,y:q,fillStyle:"#fff",strokeWidth:0,fontSize:"1em",text:e,fromCenter:!1,maxWidth:1e3},f=o.measureText(g),f.width+2*k<=m)?(g.x+=(m-f.width)/2,g.y+=(d-f.height)/2,o.drawText(g)):void 0},s=B=0;z>B;s=B+=1)if(t=d(e,f.labels[s]),t.length){for(;m>=n.length;)n.push(null);n[m]={label:t,left:0,right:0,top:m},m++}else m--;for(s=C=z;q>C;s=C+=1)if(t=d(e,f.labels[s]),y=(f.times[s]-w)/p,t.length){for(;m>=n.length;)n.push(null);n[m]={label:t,left:y,right:0,top:m},m++}else if(m--,r=n[m],r.right=y,y-r.left<k){for(;m>=u.length;)u.push(null);if(v=u[m],r.left-(null!=v?v.right:void 0)<k){v.right=y,v.multiplicity=(v.multiplicity||1)+1,v.labels[r.label]=(v.labels[r.label]||0)+1;continue}v&&v.right-v.left>=k&&A(v),r.labels={},r.labels[r.label]=1,u[m]=r}else A(r);for(D=0,E=u.length;E>D;D++)v=u[D],v&&v.right-v.left>=k&&A(v);for(;m-->0;)r=n[m],r.right=1,A(r);return b.sort(function(a,b){return a.right-b.right})},e=function(d,e){var g,i,j,k,l,m;return i={container:$(".traceview .plot-container"),plot:$(".traceview .plot"),tooltip:$(".traceview .tooltip"),marker:$(".traceview .marker"),timestamp:$(".traceview .marker .timestamp"),slider:$(".traceview .slider"),table:$(".stats tbody")},i.plot.attr("width",i.slider.width()),i.marker.height(i.plot.height()),g=null,f(i,d,e),h(i,d,e,i.slider.rangeSlider("values")),i.slider.on("valuesChanging",function(a,b){return window.requestAnimationFrame(function(){return g=null,i.marker.hide(),i.marker.width(1),h(i,d,e,b.values)})}),k=function(d){var e,f,h,j,k,l,m,n,o,p,q,r,s,t,u;if(e=10,n=i.plot.offset(),t=[d.pageX-n.left,d.pageY-n.top],q=t[0],r=t[1],p=a(b,q,function(a){return null!=a?a.right:void 0}),o=i.slider.rangeSlider("values"),g&&!g.stopped)return f=Math.abs(d.pageX-g.x),i.timestamp.text("<"+Math.round(f/i.plot.width()*(o.max-o.min))+"ms>"),i.marker.width(Math.max(1,f)),void i.marker.offset({left:Math.min(d.pageX,g.x),top:n.top});for((null!=g?g.stopped:void 0)||(i.timestamp.text(""+Math.round(q/i.plot.width()*(o.max-o.min)+o.min)+"ms"),i.marker.show().offset({left:d.pageX,top:n.top})),j=s=p,u=b.length;u>s;j=s+=1)if(h=b[j],!(q<=h.left||r<=h.top||r>h.bottom))return h.labels?(l=""+h.multiplicity+" labels<br>",m=Object.keys(h.labels),m.sort(function(a,b){return h.labels[b]-h.labels[a]}),l+=function(){var a,b,d,e;for(d=m.slice(0,3),e=[],a=0,b=d.length;b>a;a++)k=d[a],e.push(""+h.labels[k]+"&times; "+c(k));return e}().join("<br>")):l=c(h.label),l+="<br>spanning "+h.duration+"ms",i.tooltip.children(".tooltip-inner").html(l),void i.tooltip.show().offset({left:Math.max(e,Math.min(i.plot.width()-i.tooltip.width(),n.left+(h.right+h.left-i.tooltip.width())/2)),top:n.top+h.top-i.tooltip.height()-e});return i.tooltip.hide()},l=function(a){return i.tooltip.hide(),g?void(g.stopped=!0):i.marker.hide()},j=function(a){return i.tooltip.is(":visible")?void 0:(g={x:a.pageX,y:a.pageY},k(a),a.preventDefault())},m=function(a){return g?Math.abs(a.pageX-g.x)<2&&Math.abs(a.pageY-g.y)<2?(g=null,void k(a)):g.stopped=!0:void 0},i.container.mousemove(k),i.container.mouseleave(l),i.container.mousedown(j),i.container.mouseup(m)},$(function(){var a;return a=$("#tracefile"),a.change(function(){return $.getJSON(a.val()).done(function(a){return e(a,a.trace[0])})}),a.trigger("change")})}).call(this);