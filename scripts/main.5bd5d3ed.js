(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;g=/\D+|\d+(\.\d+)?[ETGMkmμnpf]?/g,n=function(a,b){var c,d,e,f,h,j,k,l;for(h=(a+"").match(g),j=(b+"").match(g),d=k=0,l=Math.min(h.length,j.length);l>=0?l>k:k>l;d=l>=0?++k:--k)if(isNaN(parseInt(h[d]))||isNaN(parseInt(j[d]))){if(e=h[d].toUpperCase(),f=j[d].toUpperCase(),f>e)return-1;if(e>f)return 1}else if(c=i(h[d])-i(j[d]),0!==c)return c;return h.length-j.length},j=function(a,b){return-n(a,b)},q=function(a,b,c){return function(d){var e,f,g;for(e=f=0,g=a.length;g>=0?g>f:f>g;e=g>=0?++f:--f)if(!(d<a[e]))return(d/a[e]).toPrecision(c[Math.min(c.length-1,e)])+b[e];return d.toPrecision(c[c.length-1])}},p=function(a,b){return function(c){var d,e,f;for(c+="",d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)if(!(c.indexOf(b[d],c.length-b[d].length)<0))return+c.slice(0,c.length-b[d].length)*a[d];return parseFloat(c)}},m=q([1e15,1e12,1e9,1e6,1e3,1,.001,1e-6,1e-9,1e-12,1e-15],["E","T","G","M","k","","m","μ","n","p","f",""],[3]),i=p([1e15,1e12,1e9,1e6,1e3,.001,1e-6,1e-9,1e-12,1e-15,1],["E","T","G","M","k","m","μ","n","p","f",""]),o=q([31556952,604800,86400,3600,60,1,.001,1e-6,1e-9,1e-12],["y","w","d","h","m","s","ms","μs","ns","ps",""],[2,2,2,2,2,2,3]),l=function(a){return(100*a).toPrecision(3)+"%"},a=function(a,b,c){var d,e,f,g,h,i,j,k;for(null==c&&(c=function(a){return a}),i=[0,a.length],h=i[0],d=i[1],e=Math.floor((h+d)/2),j=[c(a[e]),c(a[e+1])],f=j[0],g=j[1];!(b>f)||b>g;){if(b>g&&(h=e+1),b>f||(d=e),h>=d)return d;e=Math.floor((h+d)/2),k=[c(a[e]),c(a[e+1])],f=k[0],g=k[1]}return e+1},c=function(a){return a&&a.replace(/</g,"&lt;").replace(/>/g,"&gt;")},b=[],d=function(a,b){var c,d,e,f;return d=a.stringTable[b],e=d.lastIndexOf("("),f=d.lastIndexOf("/"),c=d.lastIndexOf(":"),e>=0&&f>e&&c>f?d.slice(0,e+1)+d.slice(f+1):0>e&&f>=0&&c>f?d.slice(f+1):d.replace("(<native>:0)","<native>")},k=function(a,b){var c,d,e;return e=a.slider,d=b.trace.data[0][1],c=b.trace.data[b.trace.data.length-1][1],e.rangeSlider({bounds:{min:d,max:c},defaultValues:{min:d,max:2*(c-d)/3+d},range:{min:15*(c-d)/e.width()},formatter:function(a){return Math.round(a)+"ms"},valueLabels:"change"})},f=function(b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(p=b.table,m=a(c.trace.data,e.min,function(a){return null!=a?a[1]:void 0}),f=a(c.trace.data,e.max,function(a){return null!=a?a[1]:void 0}),l=[],i=[],o={},g=r=m;f>=m?f>r:r>f;g=f>=m?++r:--r)w=[q,c.trace.data[g][1]],k=w[0],q=w[1],h=d(c,c.trace.data[g][0]),j=h.length?l[l.length-1]:l.pop(),h.length&&l.push(h),null!=j&&(null!=o[j]?(h.length||o[j].count++,o[j].time+=q-k):(i.push(j),o[j]={count:h.length?0:1,time:q-k}));for(s=0,u=l.length;u>s;s++)h=l[s],o[h]&&o[h].count++;for(i.sort(function(a,b){return o[b].time-o[a].time}),p.empty(),g=t=0,v=i.length;v>t;g=++t)h=i[g],n=o[h],p.append($("<tr/>").append($("<td/>").text(h),$("<td/>").text(n.count),$("<td/>").text((n.time/n.count).toFixed(3)),$("<td/>").text(n.time.toFixed(3))));return $.bootstrapSortable()},h=function(c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;for(H=c.plot,G=f.range.min,t=f.range.max-f.range.min,J=a(e.trace.data,G,function(a){return null!=a?a[1]:void 0}),u=a(e.trace.data,f.range.max,function(a){return null!=a?a[1]:void 0}),f.filter=f.filter&&f.filter.toLowerCase(),o=H.width(),k=H.height(),i=k/25,h=.8*i,n=4/o,g=parseFloat(H.css("fontSize")),l=5,j=1.5*h,m=4,r=H[0].getContext("2d"),r.font="1em sans-serif",r.textAlign="left",r.textBaseline="top",r.fillStyle="#fff",r.fillRect(0,0,o,k),C=[],r.beginPath(),Y=e.markers.data,N=0,R=Y.length;R>N;N++)if(B=Y[N],y=B[0],K=B[1],s=B[2],!(G>K)){if(K>=G+t)break;if(!s||"tracing"!==s.type){for(z=(K-G)/t*o,A=O=0,Z=C.length;Z>O&&!(C[A]<z);A=O+=1);for(;A>=C.length;)C.push(0);L=A*h+j,r.strokeStyle="#ccc",r.moveTo(z,L),r.lineTo(z,k),y=e.stringTable[y],r.fillStyle="#888",r.fillText(y,z+l,L),F=r.measureText(y),C[A]=z+F.width+2*l}}for(r.stroke(),q=[],p=0,D=[],b=[],M=function(a){var c,d,e,f,l,m;return l=o*a.left,m=k-(a.top+1)*i,j>m?void 0:(f=o*(a.right-a.left),d=h,c=chroma.hsl(222-222*Math.atan((a.multiplicity||0)/20)*2/Math.PI,.55,.55),a.marked||(e=c.lch(),e[1]=0,c=chroma.lch(e)),y=a.label,r.fillStyle=c.hex(),r.fillRect(l,m,f,d),r.strokeStyle=c.darken().hex(),r.strokeRect(l,m,f,d),!a.multiplicity&&f>4*n&&(F=r.measureText(y),F.width+2*n<=f&&(r.fillStyle="#fff",r.fillText(y,l+(f-F.width)/2,m+(d-g)/2))),b.push({left:l,right:l+f,top:m,bottom:m+d,label:y,labels:a.labels,multiplicity:a.multiplicity,duration:Math.round((a.right-a.left)*t)}))},x=P=0;J>P;x=P+=1)if(y=d(e,e.trace.data[x][0]),y.length){for(;p>=q.length;)q.push(null);if(q[p]={label:y,left:0,right:0,top:p,marked:!f.filter},f.filter&&y.toLowerCase().indexOf(f.filter)>=0)for(Q=0,S=q.length;S>Q;Q++)v=q[Q],v.marked=!0;p++}else p--;for(x=V=J;u>V;x=V+=1)if(y=d(e,e.trace.data[x][0]),I=(e.trace.data[x][1]-G)/t,y.length){for(;p>=q.length;)q.push(null);if(q[p]={label:y,left:I,right:0,top:p,marked:!f.filter},f.filter&&y.toLowerCase().indexOf(f.filter)>=0)for(W=0,T=q.length;T>W;W++)v=q[W],v.marked=!0;p++}else if(p--,w=q[p],w.right=I,I-w.left<n){for(;p>=D.length;)D.push(null);if(E=D[p],w.left-(null!=E?E.right:void 0)<n){E.right=I,E.multiplicity=(E.multiplicity||1)+1,E.labels[w.label]=(E.labels[w.label]||0)+1,E.marked=E.marked||w.marked;continue}E&&E.right-E.left>=n&&M(E),w.labels={},w.labels[w.label]=1,D[p]=w}else M(w);for(X=0,U=D.length;U>X;X++)E=D[X],E&&E.right-E.left>=n&&M(E);for(;p-->0;)w=q[p],w.right=1,M(w);return b.sort(function(a,b){return a.right-b.right})},e=function(d){var e,g,i,j,l,m,n;return g={container:$(".traceview .plot-container"),plot:$(".traceview .plot"),tooltip:$(".traceview .tooltip"),marker:$(".traceview .marker"),timestamp:$(".traceview .marker .timestamp"),slider:$(".traceview .slider"),table:$(".stats tbody"),filter:$(".filter")},g.plot.attr("width",g.slider.width()),g.marker.height(g.plot.height()),e=null,k(g,d),n={range:g.slider.rangeSlider("values"),filter:g.filter.val()},h(g,d,n),g.slider.on("valuesChanging",function(a,b){return window.requestAnimationFrame(function(){return e=null,g.marker.hide(),n.range=b.values,h(g,d,n)})}),g.filter.on("input",function(a){return window.requestAnimationFrame(function(){return n.filter=g.filter.val(),h(g,d,n)})}),f(g,d,n.range),g.slider.on("valuesChanged",function(a,b){return n.range=b.values,f(g,d,n.range)}),j=function(d){var f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(f=10,o=g.plot.offset(),u=[d.pageX-o.left,d.pageY-o.top],r=u[0],s=u[1],q=a(b,r,function(a){return null!=a?a.right:void 0}),p=g.slider.rangeSlider("values"),e&&!e.stopped)return h=Math.abs(d.pageX-e.x),g.timestamp.text("<"+Math.round(h/g.plot.width()*(p.max-p.min))+"ms>"),g.marker.removeClass("zoomin").width(Math.max(1,h)),void g.marker.offset({left:Math.min(d.pageX,e.x),top:o.top});if(e&&e.stopped){if(g.marker.addClass("zoomin"),n=g.marker.offset(),d.pageX>n.left&&d.pageX<n.left+g.marker.width())return void g.tooltip.hide()}else g.timestamp.text(""+Math.round(r/g.plot.width()*(p.max-p.min)+p.min)+"ms"),g.marker.removeClass("zoomin").width(1).show().offset({left:d.pageX,top:o.top});for(j=t=q,v=b.length;v>t;j=t+=1)if(i=b[j],!(r<=i.left||s<=i.top||s>i.bottom))return i.labels?(l=""+i.multiplicity+" labels:<br><br>",m=Object.keys(i.labels),m.sort(function(a,b){return i.labels[b]-i.labels[a]}),l+=function(){var a,b,d,e;for(d=m.slice(0,3),e=[],a=0,b=d.length;b>a;a++)k=d[a],e.push(""+i.labels[k]+" &times; "+(""+c(k)+"<br>"));return e}().join("")):l=c(i.label),l+="<br>spanning "+i.duration+"ms",g.tooltip.children(".tooltip-inner").html(l),void g.tooltip.show().offset({left:Math.max(f,Math.min(g.plot.width()-g.tooltip.width(),o.left+(i.right+i.left-g.tooltip.width())/2)),top:o.top+i.top-g.tooltip.height()-f});return g.tooltip.hide()},l=function(a){return g.tooltip.hide(),e?void(e.stopped=!0):g.marker.hide()},i=function(a){var b,c,d,f,h,i,k;if(!g.tooltip.is(":visible"))return b=g.marker.offset(),c=g.marker.width(),(null!=e?e.stopped:void 0)&&a.pageX>b.left&&a.pageX<b.left+c?(h=g.plot.offset(),i=g.plot.width(),k=g.slider.rangeSlider("values"),e=null,f=function(a){return(a-h.left)/i*(k.max-k.min)+k.min},d={min:f(b.left),max:f(b.left+c)},g.slider.rangeSlider("values",d.min,d.max),g.slider.trigger("valuesChanging",{values:d}),g.slider.trigger("valuesChanged",{values:d}),void j(a)):(e={x:a.pageX,y:a.pageY},j(a),a.preventDefault())},m=function(a){return e?Math.abs(a.pageX-e.x)<2&&Math.abs(a.pageY-e.y)<2?(e=null,void j(a)):e.stopped=!0:void 0},g.container.mousemove(j),g.container.mouseleave(l),g.container.mousedown(i),g.container.mouseup(m)},$(function(){var a;return a=$("#tracefile"),a.change(function(){return $.getJSON(a.val()).done(function(a){return e(a.threads[0])})}),a.trigger("change")})}).call(this);